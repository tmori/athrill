
		TOPPERS/ATK2-SC1-MC
        ＜V850プロセッサ依存部マニュアル(GHS版)＞

このドキュメントはV850プロセッサ依存部のGHS版情報を記述したものである．
GCC版と同様の箇所は説明を省いている．

----------------------------------------------------------------------
TOPPERS ATK2
    Toyohashi Open Platform for Embedded Real-Time Systems
    Automotive Kernel Version 2

Copyright (C) 2013-2017 by Center for Embedded Computing Systems
            Graduate School of Information Science, Nagoya Univ., JAPAN
Copyright (C) 2013-2014 by FUJISOFT INCORPORATED, JAPAN
Copyright (C) 2013-2014 by Renesas Electronics Corporation, JAPAN

上記著作権者は，以下の (1)～(3)の条件を満たす場合に限り，本ドキュメ
ント（本ドキュメントを改変したものを含む．以下同じ）を使用・複製・改
変・再配布（以下，利用と呼ぶ）することを無償で許諾する．
(1) 本ドキュメントを利用する場合には，上記の著作権表示，この利用条件
    および下記の無保証規定が，そのままの形でドキュメント中に含まれて
    いること．
(2) 本ドキュメントを改変する場合には，ドキュメントを改変した旨の記述
    を，改変後のドキュメント中に含めること．ただし，改変後のドキュメ
    ントが，TOPPERSプロジェクト指定の開発成果物である場合には，この限
    りではない．
(3) 本ドキュメントの利用により直接的または間接的に生じるいかなる損害
    からも，上記著作権者およびTOPPERSプロジェクトを免責すること．また，
    本ドキュメントのユーザまたはエンドユーザからのいかなる理由に基づ
    く請求からも，上記著作権者およびTOPPERSプロジェクトを免責すること．

本ドキュメントは，AUTOSAR（AUTomotive Open System ARchitecture）仕様
に基づいている．上記の許諾は，AUTOSARの知的財産権を許諾するものではな
い．AUTOSARは，AUTOSAR仕様に基づいたソフトウェアを商用目的で利用する
者に対して，AUTOSARパートナーになることを求めている．

本ドキュメントは，無保証で提供されているものである．上記著作権者およ
びTOPPERSプロジェクトは，本ドキュメントに関して，特定の使用目的に対す
る適合性も含めて，いかなる保証も行わない．また，本ドキュメントの利用
により直接的または間接的に生じたいかなる損害に関しても，その責任を負
わない．

$Id: prc_user.txt 852 2017-12-21 07:30:44Z ertl-honda $
----------------------------------------------------------------------

    ○概要

V850プロセッサ依存部（以下，V850依存部）は，ルネサスエレクトロニクスの
G3Mコア(V850E3V5アーキテクチャ)を用いたLSIをサポートしている．

現状サポートしているLSIは，次に1種類である．V850プロセッサ依存部では，
プロセッサと割り込みコントローラのみを使用するため，他のG3Mコアを用い
たLSIへのポーティングは容易である．

 ・V850/F1H

○開発環境

カーネルのコンパイルは，GHS を用いている．動作確認を行なったバージョン
は以下のものである．

 ・comp_201517

デバッガは，CS+を使用して動作確認をしている．動作確認をしたバージョン
は次の通りである．

 ・CS+ V3.03.000 

○周辺回路

サンプルを動作させるためには，周辺回路として，UARTとタイマが必要となる．
V850依存部では，UARTとしては，アシンクロナス・シリアル・インタフェース
（UARTEn）を，タイマとしては，タイマアレイユニット（TAUn）をサポートし
ている．使用するチャネルはターゲット毎に異なる．


○TAUn割込みハンドラ(in taua_timer.c)

IncrementCounter(SysTimerCnt)により，SysTimerCntのソフトウェアカウンタを
インクリメントしている．IncrementCounter(SysTimerCnt)の戻り値がE_OK以外の
場合，ShutdownOS()を呼び出している．


○割込み優先度

CFG_INTに指定可能な割込み優先度としては，以下の値を設定可能である．

G3M : -1 ～ -16


○割込み属性

CFG_INTでサポートしている割込み属性はない．


○未登録の割込み

未登録の割込みが発生した場合は，prc_config.c で定義されている，
default_int_handler() を呼び出す．default_int_handler() は，発生した割
り込みの割込み番号をコンソールに出力した後，target_exit() を呼び出す．

○C1ISRの扱い

・C1ISRにはユーザによって以下の処理が記述されるべきである．
    ・C1ISRで使用するレジスタの内容を退避
    ・C1ISRが実行中であることを判別するための情報を保存する
        ・現在の実装ではiipm
    ・退避したレジスタの復帰
    ・eret命令でC1ISRを終了する

                
○CPU例外要因情報取得

・CPU例外発生した場合，ユーザは，プロテクションからCPU例外情報を取得で
  き，取得できるのは，CPU例外発生時の以下の情報がある．
    ・CPU例外要因番号(変数：v850_cpu_exp_no)
    ・プログラムカウンタ(変数：v850_cpu_exp_pc)
    ・スタックポインタ(変数：v850_cpu_exp_sp)
        ・更に，CPU例外発生時に各レジスタはスタックに保存しているので，
          v850_cpu_exp_spを使って保存してあるレジスタの値を取得するこ
          とができる．保存してあるレジスタとアドレスの情報はアセンブリ
          コードを参照する．
                    
・しかし，プロテクションフック無効の場合，上記のCPU例外要因保持用変数が
  定義されないため，使用しないでください(使用した場合，コンパイルエラー
  となる)．

○制限事項

ep相対でアクセスするtinyデータセクションはサポートしない．


○変更履歴
2017/12/21
・リンカスクリプトの見直し

2017/09/25
・Makefile.prc
  ・CDEFSにでTOPPERS_LABEL_ASMを定義するよう変更
  
2016/08/09
・V850_MEMORY_CHANGED をGHSの __memory_changed() に変更．

2015/12/30
・共通部 1.4.0 対応．

2015/10/13
・Makefile.prc
  コンパイルオプションの見直し．
  -cpu=v850e3v5 から -cpu=rh850g3m に変更
  -large_sda を追加
  最適化オプションを -Ospeed -Omax -Olink -Ointerproc に変更

2015/03/31
・prc_support.S/prc_insn.h
  PSW.EBV，EBASE，INTBP，ISPR，PMR，ICSR，INTCFG の更新時はdi状態とす
  る必要があるため，該当箇所を修正．
          
以上．
